function r(o){let t=Math.floor(o/3600),e=Math.floor(o%3600/60),s=Math.floor(o%60);return t>0?`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function p(){return/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&!window.MSStream&&navigator.maxTouchPoints&&navigator.maxTouchPoints>1}function n(o,t){localStorage.getItem(o)||localStorage.setItem(o,t)}function m(o,t){let e,s;return function(...i){let a=this;s?(clearTimeout(e),e=setTimeout(function(){Date.now()-s>=t&&(o.apply(a,i),s=Date.now())},t-(Date.now()-s))):(o.apply(a,i),s=Date.now())}}function d(o,t="js-added-style",e=document.head){let s;e.querySelector(`#${t}`)?(s=e.querySelector(`#${t}`),s.textContent=o):(s=document.createElement("style"),s.id=t,e.insertBefore(s,e.firstChild),s.textContent=o)}function v(o="#scrubber"){d(` ${o}::-webkit-slider-thumb { scale:0; opacity:0; transition: scale .2s ease-in-out, opacity .3s var(--back-out, ease-out); } ${o}::-moz-range-thumb { scale:0; opacity:0; transition: scale .2s ease-in-out, opacity .3s var(--back-out, ease-out); } `)}function y(o="#scrubber"){d(` ${o}::-webkit-slider-thumb { scale: 1; opacity: 1; } ${o}::-moz-range-thumb { scale: 1; opacity: 1; } `)}function c(o){let{src:t,title:e,thumb:s,totalTime:i="",position:a="",variation:l="",svgBase:h}=o;return` <div class="pp-wrapper"> <div> <slot></slot> </div> <audio preload="metadata" src="${t}"></audio> <div class="podcast-player" data-variation="${l}" data-position="${a}" inert hidden> ${b(s)} ${f(e,i,h)} ${g(h)} </div> </div> `}function b(o){return o?`<header style="background-image: url('${o}')"></header>`:""}function g(o){return` <footer class="flex space-between"> <button title="Close player" class="invert | podcast-icon circle-small icon-close" id="icon-close"> <svg style="width: 1.5rem; height: 1.5rem; scale: .75;"> <use href="${o}#close-icon"></use> </svg> </button> <button title="Change position" type="button" class="invert | podcast-icon circle-small icon-move"> <svg style="height:1.5rem; width:1.5rem; scale: .6;"> <use href="${o}#move-icon"></use> </svg> </button> </footer>`}function f(o,t,e){return` <div class="main controls flex width-100"> <section> <button class="play-pause icon-button circle podcast-icon"> <div> <svg><use href="${e}#play-solid"></use></svg> <span class="visually-hidden">Play</span> </div> <div> <svg><use href="${e}#pause-solid"></use></svg> <span class="visually-hidden">Pause</span> </div> </button> <div id="time-display-current" class="controls-surface flex"> <time>00:00</time> <button type="button" title="Share with current timestamp" style="color: hsl(var(--clr-hue) var(--clr-sat) 12.5% / 100%); border-radius: 8px;" class="share-button | ghost icon-button"> <div class="bg-icon" style="background-image: url(${e}#share-icon);"> <span class="visually-hidden">Share</span> </div> </button> </div> <label for="scrubber" class="flex"> <span class="visually-hidden">Seek Bar</span> <input type="range" id="scrubber" min="0" max="0" value="0"> </label> <div id="time-display-end" class="controls-surface mr-small"><time>${t||" --&thinsp;:&thinsp;-- "}</time></div> </section> <section> <h3 class="audio-title" title="${o}">${o}</h3> <div class="controls-surface-2 flex"> <button class="mute podcast-icon"> <svg class="button-icon mute-svg" aria-label="Mute"><use href="${e}#unmute-icon"></use></svg> <svg class="button-icon unmute-svg hidden" aria-label="Unmute"><use href="${e}#mute-icon"></use></svg> </button> <div class="flex | volume-group | controls-surface" style="margin-block: 1px;"> <label for="volume-control" class="visually-hidden">Volume</label> <input data-size="small" type="range" id="volume-control" class="volume" value=".35" min="0" max="1" step="0.01" title="Volume"> </div> <div class="flex"> <label for="speed-control" class="visually-hidden">Speed</label> <select title="Playback speed" data-size="small" id="speed-control" class="podcast-icon"> <option value="0.2">0.2x</option><option value="0.5">0.5x</option> <option value="1" selected>1.0x</option><option value="1.2">1.2x</option><option value="1.5">1.5x</option><option value="1.7">1.7x</option> <option value="2">2.0x</option><option value="2.2">2.2x</option><option value="2.5">2.5x</option><option value="2.7">2.7x</option> </select> </div> </div> </section> </div>`}var u=class extends HTMLElement{constructor(){super(),this.showOn=this.getAttribute("show-on"),this.setSrcAttribute(),this.setSvgBaseAttribute(),this.initLocalStorage()}connectedCallback(){this.scopeStyles(),this.injectTemplate(),this.initRefs(),this.processLightDomIcons(),this.initUi(),this.addEventListeners(),this.addShareFunctionality(),this.addShowOn()}handleToggleMute(){this.audio.muted=!this.audio.muted,localStorage.setItem("pp-mute",this.audio.muted),this.audio.muted?(this.muteButton.querySelector(".mute-svg").classList.add("hidden"),this.muteButton.querySelector(".unmute-svg").classList.remove("hidden")):(this.muteButton.querySelector(".mute-svg").classList.remove("hidden"),this.muteButton.querySelector(".unmute-svg").classList.add("hidden"))}handleClose(t){this.audio.paused===!1&&this.handleShowAndPlay(t),this.podcastPlayer.classList.remove("show"),this.removeAttribute("showing-player"),this.podcastPlayer.setAttribute("inert","")}handleMove(){this.podcastPlayer.dataset.position!=="top"?(localStorage.setItem("pp-position","top"),this.setAttribute("data-position","top"),this.podcastPlayer.dataset.position="top"):(localStorage.setItem("pp-position","bottom"),this.setAttribute("data-position","bottom"),this.podcastPlayer.dataset.position="bottom")}handleShowAndPlay(t){t.preventDefault(),this.showPlayer(),this.handleTogglePlayPause(t)}beforePlay(){let t=this.audio;t.playbackRate=localStorage.getItem("pp-speed")||1,t.volume=localStorage.getItem("pp-volume")??.7,!t.muted&&localStorage.getItem("pp-mute")==="true"&&this.handleToggleMute()}handleTogglePlayPause(t){t.preventDefault();let e=this.audio;e.paused?(this.beforePlay(),e.play(),this.ppWrapper.classList.add("audio-playing"),document.querySelector("body").classList.add("audio-playing"),this.ppWrapper.classList.remove("audio-paused"),document.querySelector("body").classList.remove("audio-paused")):(e.pause(),this.ppWrapper.classList.add("audio-paused"),document.querySelector("body").classList.add("audio-paused"),this.ppWrapper.classList.remove("audio-playing"),document.querySelector("body").classList.remove("audio-playing"))}handleLoadMetadata(){let t=this.audio.duration;this.scrubber.max=t,this.timeDisplayEnd.textContent=r(t),this.updateSecondsFromUrl();let e=this.audio.currentTime;this.timeDisplayCurrent.textContent=r(e),this.scrubber.value=e,y()}handleUpdateTime=m(function(){let t=this.audio.currentTime;this.scrubber.value=t,this.timeDisplayCurrent.textContent=r(t)},300);handleScrub(){this.audio.currentTime=this.scrubber.value}handleChangeSpeed(){this.audio.playbackRate=this.speedControl.value,localStorage.setItem("pp-speed",this.speedControl.value)}handleControlVolume(){this.audio.volume=this.volumeControl.value,localStorage.setItem("pp-volume",this.volumeControl.value)}registerHandler(t,e,s="click"){this[t.name]=t.bind(this),e.addEventListener(s,this[t.name]),this.handlers.push([t,e,s])}unregisterHandler(t,e,s="click"){e.removeEventListener(s,this[t.name])}addShowOn(){(this.showOn==="scroll"||!this.showOn)&&this.addIntersectionObserver(),this.showOn!=="click"&&(this.showOn==="load"&&this.showPlayer(),this.showOn==="hover"&&this.showAndPlay.addEventListener("mouseenter",()=>this.showPlayer()))}addIntersectionObserver(){let t={threshold:1,rootMargin:"100px 0px -100px 0px"},e=0,s=new IntersectionObserver(i=>{i.isIntersecting||(e?(this.showPlayer(),s.unobserve(this.showAndPlay)):e=1)},t);s.observe(this.showAndPlay)}addShareFunctionality(){if(!navigator.share){this.shareButton.style.display="none";return}this.shareButton.addEventListener("click",t=>{let e=Math.floor(this.audio.currentTime),s=new URL(window.location.href);e&&s.searchParams.set("seconds",e);let i=s.toString(),a=document.title+(e?` (${r(e)})`:"");navigator.share({title:a,url:i}).catch(()=>null)})}showPlayer(){this.podcastPlayer.classList.add("show"),this.setAttribute("showing-player",""),this.podcastPlayer.removeAttribute("inert"),this.podcastPlayer.hidden=!1}addEventListeners(){let t=this.registerHandler.bind(this);this.handlers=[],t(this.handleShowAndPlay,this.showAndPlay),t(this.handleTogglePlayPause,this.playPauseButton),this.audio.readyState>0?this.handleLoadMetadata():t(this.handleLoadMetadata,this.audio,"loadedmetadata"),t(this.handleUpdateTime,this.audio,"timeupdate"),t(this.handleScrub,this.scrubber,"input"),t(this.handleChangeSpeed,this.speedControl,"change"),t(this.handleControlVolume,this.volumeControl,"input"),t(this.handleToggleMute,this.muteButton),t(this.handleMove,this.moveButton),t(this.handleClose,this.closeButton)}initRefs(){this.showAndPlay=this.querySelector(".show-and-play");let t=this.shadowRoot??this;this.ppWrapper=t.querySelector(".pp-wrapper"),this.audio=t.querySelector("audio"),this.podcastPlayer=t.querySelector(".podcast-player"),this.playPauseButton=t.querySelector(".play-pause"),this.scrubber=t.querySelector("#scrubber"),this.timeDisplayCurrent=t.querySelector("#time-display-current time"),this.timeDisplayEnd=t.querySelector("#time-display-end time"),this.muteButton=t.querySelector(".mute"),this.volumeControl=t.querySelector("#volume-control"),this.speedControl=t.querySelector("#speed-control"),this.shareButton=t.querySelector(".share-button"),this.moveButton=t.querySelector(".icon-move"),this.closeButton=t.querySelector(".icon-close"),this.volumeGroup=t.querySelector(".volume-group")}initLocalStorage(){n("pp-position",this.getAttribute("data-position")??"bottom"),n("pp-volume",.7),n("pp-speed",1),n("pp-mute",!1)}updateSecondsFromUrl(){let t=new URL(window.location.href),e=t.searchParams.get("seconds");e&&(this.audio.currentTime=e,t.searchParams.delete("seconds"),window.history.pushState({},"",t),this.showPlayer())}initUi(){this.audio.hidden=!0;let t=localStorage.getItem("pp-position");this.setAttribute("data-position",t),this.podcastPlayer.dataset.position=t;let e=this.getAttribute("data-variation");this.podcastPlayer.dataset.variation=e,this.speedControl.value=localStorage.getItem("pp-speed"),this.volumeControl.value=localStorage.getItem("pp-volume"),v(),p()&&(this.volumeGroup.style.display="none")}injectTemplate(){let t=this.shadowRoot??this;t.innerHTML+=c({src:this.getAttribute("data-src"),title:this.getAttribute("data-title"),thumb:this.getAttribute("data-thumb"),position:this.getAttribute("data-position"),variation:this.getAttribute("data-variation"),svgBase:this.getAttribute("svg-base")})}setSrcAttribute(){if(this.hasAttribute("data-src"))return;let t=this.querySelector("a").getAttribute("href");this.setAttribute("data-src",t)}setSvgBaseAttribute(){if(this.hasAttribute("svg-base"))return;let t=`link[media=scoped-${this.localName}][rel=icon]`,e=document.querySelector(t)?.getAttribute("href");e&&this.setAttribute("svg-base",e)}processLightDomIcons(){let t=this.showAndPlay.querySelectorAll("i[data-icon]"),e=this.getAttribute("svg-base");t.forEach(s=>{let i=s.getAttribute("data-icon"),a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("aria-hidden","true");let l=document.createElementNS("http://www.w3.org/2000/svg","use");l.setAttributeNS("http://www.w3.org/1999/xlink","href",`${e}#${i}`),a.appendChild(l),s.replaceWith(a)})}scopeStyles(){this.shadowRoot||this.attachShadow({mode:"open"});let t=`link[media=scoped-${this.localName}][rel=stylesheet]`,e=document.querySelectorAll(t);e&&e.forEach(s=>{let i=s.cloneNode(!0);i.setAttribute("media","all"),this.shadowRoot.appendChild(i)})}};customElements.define("podcast-player",u);export{u as default};
//# sourceMappingURL=script.min.js.map
