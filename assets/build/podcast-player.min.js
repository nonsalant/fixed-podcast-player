function n(o){let e=Math.floor(o/3600),t=Math.floor(o%3600/60),s=Math.floor(o%60);return e>0?`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function y(){return/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&!window.MSStream&&navigator.maxTouchPoints&&navigator.maxTouchPoints>1}function d(o,e){localStorage.getItem(o)||localStorage.setItem(o,e)}function v(o,e){let t,s;return function(...a){let i=this;s?(clearTimeout(t),t=setTimeout(function(){Date.now()-s>=e&&(o.apply(i,a),s=Date.now())},e-(Date.now()-s))):(o.apply(i,a),s=Date.now())}}function c(o,e="js-added-style",t=document.head){let s;t.querySelector(`#${e}`)?(s=t.querySelector(`#${e}`),s.textContent=o):(s=document.createElement("style"),s.id=e,t.insertBefore(s,t.firstChild),s.textContent=o)}function b(o="#scrubber"){c(` ${o}::-webkit-slider-thumb { scale:0; opacity:0; transition: scale .2s ease-in-out, opacity .3s var(--back-out, ease-out); } ${o}::-moz-range-thumb { scale:0; opacity:0; transition: scale .2s ease-in-out, opacity .3s var(--back-out, ease-out); } `)}function g(o="#scrubber"){c(` ${o}::-webkit-slider-thumb { scale: 1; opacity: 1; } ${o}::-moz-range-thumb { scale: 1; opacity: 1; } `)}function p(o){let{src:e,title:t,thumb:s,totalTime:a="",position:i="",variation:h="",svgBase:l}=o;return` <div class="pp-wrapper"> <div> <slot></slot> </div> <audio preload="metadata" src="${e}"></audio> <div class="podcast-player" data-variation="${h}" data-position="${i}" inert hidden> ${f(s)} ${w(t,a,l)} ${S(l)} </div> </div> `}function f(o){return o?`<header style="background-image: url('${o}')"></header>`:""}function S(o){return` <footer class="flex space-between"> <button aria-label="Close player" type="button" class="invert | podcast-icon circle-small icon-close" id="icon-close"> <svg style="width: 1.5rem; height: 1.5rem;"> <use href="${o}#close-icon"></use> </svg> </button> <button aria-label="Change position" type="button" class="invert | podcast-icon circle-small icon-move"> <svg style="height: 1.5rem; width: 1.5rem; scale: .75"> <use href="${o}#move-icon"></use> </svg> </button> </footer>`}function w(o,e,t){return` <div class="main controls flex width-100"> <section> <button class="play-pause icon-button circle podcast-icon"> <div> <svg><use href="${t}#play-solid"></use></svg> <span class="visually-hidden">Play</span> </div> <div> <svg><use href="${t}#pause-solid"></use></svg> <span class="visually-hidden">Pause</span> </div> </button> <div id="time-display-current" class="controls-surface flex"> <time aria-label="Current time">00:00</time> <button type="button" title="Share with current timestamp" style="color: hsl(var(--clr-hue) var(--clr-sat) 12.5% / 100%); border-radius: 8px;" class="share-button | ghost icon-button"> <div class="bg-icon" style="background-image: url(${t}#share-icon);"> <span class="visually-hidden">Share</span> </div> </button> </div> <label for="scrubber" class="flex"> <span class="visually-hidden">Seek Bar</span> <input type="range" id="scrubber" min="0" max="0" value="0"> </label> <div id="time-display-end" class="controls-surface mr-small"> <time aria-label="Duration">${e||" --&thinsp;:&thinsp;-- "}</time> </div> </section> <section> <h3 class="audio-title" title="${o}">${o}</h3> <div class="controls-surface-2 flex"> <button class="mute podcast-icon"> <svg class="button-icon mute-svg" aria-label="Mute"><use href="${t}#unmute-icon"></use></svg> <svg class="button-icon unmute-svg hidden" aria-label="Unmute"><use href="${t}#mute-icon"></use></svg> </button> <div class="flex | volume-group | controls-surface" style="margin-block: 1px;"> <label for="volume-control" class="visually-hidden">Volume</label> <input data-size="small" type="range" id="volume-control" class="volume" value=".35" min="0" max="1" step="0.01" title="Volume"> </div> <div class="flex"> <label for="speed-control" class="visually-hidden">Speed</label> <select title="Playback speed" data-size="small" id="speed-control" class="podcast-icon"> <option value="0.2">0.2x</option><option value="0.5">0.5x</option> <option value="1" selected>1.0x</option><option value="1.2">1.2x</option><option value="1.5">1.5x</option><option value="1.7">1.7x</option> <option value="2">2.0x</option><option value="2.2">2.2x</option><option value="2.5">2.5x</option><option value="2.7">2.7x</option> </select> </div> </div> </section> </div>`}var u=class extends HTMLElement{constructor(){super(),this.showOn=this.getAttribute("show-on"),this.initSrcAttribute(),this.initSvgBaseAttribute(),this.initLocalStorage()}connectedCallback(){this.scopeStyles(),this.injectStylesFromGlobal(),this.injectTemplate(),this.initRefs(),this.processLightDomIcons(),this.initUi(),this.addEventListeners(),this.addShareFunctionality(),this.addShowOn()}disconnectedCallback(){document.querySelector("body").classList.remove("audio-playing","audio-paused")}initRefs(){this.showAndPlay=this.querySelector(".show-and-play");let e=this.shadowRoot??this;this.ppWrapper=e.querySelector(".pp-wrapper"),this.audio=e.querySelector("audio"),this.podcastPlayer=e.querySelector(".podcast-player"),this.playPauseButton=e.querySelector(".play-pause"),this.scrubber=e.querySelector("#scrubber"),this.timeDisplayCurrent=e.querySelector("#time-display-current time"),this.timeDisplayEnd=e.querySelector("#time-display-end time"),this.muteButton=e.querySelector(".mute"),this.volumeControl=e.querySelector("#volume-control"),this.speedControl=e.querySelector("#speed-control"),this.shareButton=e.querySelector(".share-button"),this.moveButton=e.querySelector(".icon-move"),this.closeButton=e.querySelector(".icon-close"),this.volumeGroup=e.querySelector(".volume-group")}addEventListeners(){let e=this.registerHandler.bind(this);this.handlers=[],e(this.handleShowAndPlay,this.showAndPlay),e(this.handleTogglePlayPause,this.playPauseButton),e(this.handleMouseEnterShowAndPlay,this.showAndPlay,"mouseenter"),e(this.handleMouseLeaveShowAndPlay,this.showAndPlay,"mouseleave"),e(this.handleMouseEnterPlayPause,this.playPauseButton,"mouseenter"),e(this.handleMouseLeavePlayPause,this.playPauseButton,"mouseleave"),e(this.handleMouseEnterClose,this.closeButton,"mouseenter"),e(this.handleMouseLeaveClose,this.closeButton,"mouseleave"),this.audio.readyState>0?this.handleLoadMetadata():e(this.handleLoadMetadata,this.audio,"loadedmetadata"),e(this.handleUpdateTime,this.audio,"timeupdate"),e(this.handleScrub,this.scrubber,"input"),e(this.handleChangeSpeed,this.speedControl,"change"),e(this.handleControlVolume,this.volumeControl,"input"),e(this.handleToggleMute,this.muteButton),e(this.handleMove,this.moveButton),e(this.handleClose,this.closeButton)}handleToggleMute(){this.audio.muted=!this.audio.muted,localStorage.setItem("pp-mute",this.audio.muted),this.audio.muted?(this.muteButton.querySelector(".mute-svg").classList.add("hidden"),this.muteButton.querySelector(".unmute-svg").classList.remove("hidden")):(this.muteButton.querySelector(".mute-svg").classList.remove("hidden"),this.muteButton.querySelector(".unmute-svg").classList.add("hidden"))}handleClose(e){this.audio.paused===!1&&this.handleShowAndPlay(e),this.podcastPlayer.classList.remove("show"),this.removeAttribute("showing-player"),this.podcastPlayer.setAttribute("inert","")}handleMove(){this.podcastPlayer.dataset.position!=="top"?(localStorage.setItem("pp-position","top"),this.setAttribute("data-position","top"),this.podcastPlayer.dataset.position="top"):(localStorage.setItem("pp-position","bottom"),this.setAttribute("data-position","bottom"),this.podcastPlayer.dataset.position="bottom")}handleShowAndPlay(e){e.preventDefault(),this.showPlayer(),this.handleTogglePlayPause(e)}beforePlay(){let e=this.audio;e.playbackRate=localStorage.getItem("pp-speed")||1,e.volume=localStorage.getItem("pp-volume")??.7,!e.muted&&localStorage.getItem("pp-mute")==="true"&&this.handleToggleMute()}handleTogglePlayPause(e){e.preventDefault();let t=this.audio;t.paused?(this.beforePlay(),t.play(),this.ppWrapper.classList.add("audio-playing"),document.querySelector("body").classList.add("audio-playing"),this.ppWrapper.classList.remove("audio-paused"),document.querySelector("body").classList.remove("audio-paused")):(t.pause(),this.ppWrapper.classList.add("audio-paused"),document.querySelector("body").classList.add("audio-paused"),this.ppWrapper.classList.remove("audio-playing"),document.querySelector("body").classList.remove("audio-playing"))}handleLoadMetadata(){let e=this.audio.duration;this.scrubber.max=e,this.timeDisplayEnd.textContent=n(e),this.updateSecondsFromUrl();let t=this.audio.currentTime;this.timeDisplayCurrent.textContent=n(t),this.scrubber.value=t,g()}handleUpdateTime=v(function(){let e=this.audio.currentTime;this.scrubber.value=e,this.timeDisplayCurrent.textContent=n(e)},300);handleScrub(){this.audio.currentTime=this.scrubber.value}handleChangeSpeed(){this.audio.playbackRate=this.speedControl.value,localStorage.setItem("pp-speed",this.speedControl.value)}handleControlVolume(){this.audio.volume=this.volumeControl.value,localStorage.setItem("pp-volume",this.volumeControl.value)}handleMouseEnterShowAndPlay(){this.podcastPlayer.classList.add("related-hover")}handleMouseLeaveShowAndPlay(){this.podcastPlayer.classList.remove("related-hover")}handleMouseEnterPlayPause(){this.showAndPlay.classList.add("related-hover")}handleMouseLeavePlayPause(){this.showAndPlay.classList.remove("related-hover")}handleMouseEnterClose(){this.showAndPlay.classList.add("related-hover")}handleMouseLeaveClose(){this.showAndPlay.classList.remove("related-hover")}registerHandler(e,t,s="click"){this[e.name]=e.bind(this),t.addEventListener(s,this[e.name]),this.handlers.push([e,t,s])}unregisterHandler(e,t,s="click"){t.removeEventListener(s,this[e.name])}addShowOn(){(this.showOn==="scroll"||!this.showOn)&&this.addIntersectionObserver(),this.showOn!=="click"&&(this.showOn==="load"&&this.showPlayer(),this.showOn==="hover"&&this.showAndPlay.addEventListener("mouseenter",()=>this.showPlayer()))}addIntersectionObserver(){let e={threshold:1,rootMargin:"100px 0px -100px 0px"},t=0,s=new IntersectionObserver(a=>{a.isIntersecting||(t?(this.showPlayer(),s.unobserve(this.showAndPlay)):t=1)},e);s.observe(this.showAndPlay)}addShareFunctionality(){if(!navigator.share){this.shareButton.style.display="none";return}this.shareButton.addEventListener("click",e=>{let t=Math.floor(this.audio.currentTime),s=new URL(window.location.href);t&&s.searchParams.set("seconds",t);let a=s.toString(),i=document.title+(t?` (${n(t)})`:"");navigator.share({title:i,url:a}).catch(()=>null)})}showPlayer(){this.podcastPlayer.classList.add("show"),this.setAttribute("showing-player",""),this.podcastPlayer.removeAttribute("inert"),this.podcastPlayer.hidden=!1}initLocalStorage(){d("pp-position",this.getAttribute("data-position")??"bottom"),d("pp-volume",.7),d("pp-speed",1),d("pp-mute",!1)}updateSecondsFromUrl(){let e=new URL(window.location.href),t=e.searchParams.get("seconds");t&&(e.searchParams.delete("seconds"),window.history.pushState({},"",e),this.audio.currentTime=t,this.showPlayer())}initUi(){this.audio.hidden=!0;let e=localStorage.getItem("pp-position");this.setAttribute("data-position",e),this.podcastPlayer.dataset.position=e;let t=this.getAttribute("data-variation");this.podcastPlayer.dataset.variation=t,this.speedControl.value=localStorage.getItem("pp-speed"),this.volumeControl.value=localStorage.getItem("pp-volume"),b(),y()&&(this.volumeGroup.style.display="none")}injectTemplate(){let e=this.shadowRoot??this;e.innerHTML+=p({src:this.getAttribute("data-src"),title:this.getAttribute("data-title"),thumb:this.getAttribute("data-thumb"),position:this.getAttribute("data-position"),variation:this.getAttribute("data-variation"),svgBase:this.getAttribute("svg-base")})}initSrcAttribute(){let e=this.querySelector(".show-and-play").getAttribute("href");e&&this.setAttribute("data-src",e)}initSvgBaseAttribute(){if(this.hasAttribute("svg-base"))return;let t=document.querySelector("link.fpp[rel=icon-sprite-sheet]")?.getAttribute("href");t&&this.setAttribute("svg-base",t)}processLightDomIcons(){let e=[{text:"Play",icon:"play-circle-solid"},{text:"Pause",icon:"pause-circle"},{text:"Resume",icon:"play-circle"}],t=this.showAndPlay.querySelectorAll("& > *");if(this.showAndPlay.childNodes.length===1&&this.showAndPlay.childNodes[0].nodeType===3){let a=document.createElement("span");a.textContent=this.showAndPlay.textContent,this.showAndPlay.textContent="",this.showAndPlay.appendChild(a),t=this.showAndPlay.querySelectorAll("& > *")}let s=this.getAttribute("svg-base");e.forEach((a,i)=>{if(t[i]){let r=document.createElement("span");for(;t[i].firstChild;)r.appendChild(t[i].firstChild);t[i].appendChild(r)}else{let r=document.createElement("span");r.textContent=a.text,this.showAndPlay.appendChild(r),t=this.showAndPlay.querySelectorAll("& > *")}let h=t[i].getAttribute("icon-name")||a.icon,l=document.createElementNS("http://www.w3.org/2000/svg","svg"),m=document.createElementNS("http://www.w3.org/2000/svg","use");m.setAttribute("href",`${s}#${h}`),l.appendChild(m),l.setAttribute("aria-hidden","true"),t[i].insertBefore(l,t[i].firstChild)})}scopeStyles(){this.shadowRoot||this.attachShadow({mode:"open"});let t=document.querySelectorAll("link.fpp[media=none][rel=stylesheet]");t&&t.forEach(s=>{let a=s.cloneNode(!0);a.setAttribute("media","all"),this.shadowRoot.appendChild(a)})}injectStylesFromGlobal(){let t=document.querySelectorAll("link.fpp[rel=stylesheet]:not([media=none])");t&&t.forEach(s=>{let a=s.cloneNode(!0);this.shadowRoot.appendChild(a)})}};customElements.define("podcast-player",u);export{u as default};
//# sourceMappingURL=podcast-player.min.js.map
